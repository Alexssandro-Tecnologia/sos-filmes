<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" href="../favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="../style/style.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@300;400;700&family=Poppins&display=swap" rel="stylesheet">

  <title>Lista de Filmes</title>
</head>

<body>
  <div class="container-geral">
    <header class="cabecario-bg">
      <nav class="cabecario">
        <a href="../index.html"><img src="../img/banner.png" alt=""></a>
        <ul>
          <li><a href="../cadastro/cadastro.html">cadastrar</a></li>
          <li><a href="../lista-filmes/lista-filmes.html">lista de filmes</a></li>
          <li><a href="../edicao-filmes/edicao-filmes.html">editar</a></li>
        </ul>
      </nav>
    </header>
    <main class="container conteudo">
      <h1>Lista de Filmes</h1>
      <p>Escolha abaixo o filme desejado!</p>
    </main>
    <div class="container" id="filmes-container"></div>
    <script>
      fetch("/filmes")
        .then(res => {
          if (!res.ok) throw new Error("Erro na resposta do servidor");
          return res.json();
        })
        .then(filmes => {
          const container = document.getElementById("filmes-container");
          filmes.forEach(filme => {
            const card = document.createElement("div");
            card.className = "filme";
            card.innerHTML = `
              <img 
                src="data:image/png;base64,${arrayBufferToBase64(filme.imagem.data)}" 
                alt="${filme.nome}" 
                class="filme-thumb"
                data-nome="${filme.nome}"
                data-genero="${filme.genero}"
                data-lancamento="${filme.lancamento}"
                data-duracao="${filme.duracao}"
                data-sinopse="${filme.sinopse}"
              />
             `;

            // Adiciona o evento de clique para abrir o modal
            card.querySelector("img").addEventListener("click", function () {
              document.getElementById("modal-img").src = this.src;
              document.getElementById("modal-nome").textContent = this.dataset.nome;
              document.getElementById("modal-genero").textContent = this.dataset.genero;
              document.getElementById("modal-lancamento").textContent = this.dataset.lancamento;
              document.getElementById("modal-duracao").textContent = this.dataset.duracao;
              document.getElementById("modal-sinopse").textContent = this.dataset.sinopse;

              document.getElementById("modal").classList.remove("hidden");

              document.getElementById("fechar-modal").addEventListener("click", () => {
                document.getElementById("modal").classList.add("hidden");
              });
            });

            container.appendChild(card);
          });
        })
        .catch(err => console.error(err));

      function arrayBufferToBase64(bufferData) {
        let binary = '';
        const bytes = bufferData;
        for (let b of bytes) {
          binary += String.fromCharCode(b);
        }
        return window.btoa(binary);
      }
    </script>
    <div id="modal" class="modal hidden">
      <div class="modal-content">
        <span id="fechar-modal" class="fechar">&times;</span>
        <div class="modal-filme">
          <img id="modal-img" src="" alt="Imagem do filme" />
          <div class="filme-info">
            <h2 id="modal-nome"></h2>
            <p><strong>Gênero:</strong> <span id="modal-genero"></span></p>
            <p><strong>Lançamento:</strong> <span id="modal-lancamento"></span></p>
            <p><strong>Duração:</strong> <span id="modal-duracao"></span></p>
            <p class="sinopse"><strong>Sinopse:</strong> <span id="modal-sinopse"></span></p>
          </div>
        </div>
      </div>
    </div>
    <footer class="rodape-bg">
      <div class="rodape">
        <p>S.O.S Filmes - 2025 Todos os direitos reservados</p>
      </div>
    </footer>
  </div>
  <script src="script.js"></script>
</body>

</html>