<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" href="../favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="../style/style.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@300;400;700&family=Poppins&display=swap" rel="stylesheet">

  <title>Lista de Filmes</title>
</head>

<body>
  <div class="container-geral">
    <header class="cabecario-bg">
      <nav class="cabecario">
        <a href="../index.html"><img src="../img/banner.png" alt=""></a>
        <ul>
          <li><a href="../cadastro/cadastro.html">cadastrar</a></li>
          <li><a href="../lista-filmes/lista-filmes.html">lista de filmes</a></li>
          <li><a href="../editar.html">editar</a></li>
        </ul>
      </nav>
    </header>
    <main class="container conteudo">
      <h1>Lista de Filmes</h1>
      <p>Escolha abaixo o filme desejado!</p>
    </main>
    <div class="container" id="filmes-container"></div>
    <script>
      fetch("/filmes")
        .then(res => {
          if (!res.ok) throw new Error("Erro na resposta do servidor");
          return res.json();
        })
        .then(filmes => {
          const container = document.getElementById("filmes-container");
          filmes.forEach(filme => {
            const card = document.createElement("div");
            card.className = "filme";
            card.innerHTML = `
        <h2>${filme.nome}</h2>
        <p><strong>Gênero:</strong> ${filme.genero || 'Sem gênero'}</p>
        <p><strong>Lançamento:</strong> ${filme.lancamento}</p>
        <p><strong>Duração:</strong> ${filme.duracao}</p>
        <p><strong>Sinopse:</strong> ${filme.sinopse}</p>
        ${filme.imagem ? `<img src="data:image/png;base64,${arrayBufferToBase64(filme.imagem.data)}" alt="Imagem do filme">` : ""}
      `;
            container.appendChild(card);
          });
        })
        .catch(err => console.error(err));

      function arrayBufferToBase64(bufferData) {
        let binary = '';
        const bytes = bufferData;
        for (let b of bytes) {
          binary += String.fromCharCode(b);
        }
        return window.btoa(binary);
      }
    </script>
    <footer class="rodape-bg">
      <div class="rodape">
        <p>S.O.S Filmes - 2025 Todos os direitos reservados</p>
      </div>
    </footer>
  </div>
</body>

</html>